#+title: Emacs Configuration file


* Basic Configuration
** Username
#+begin_src emacs-lisp :tangle yes
;; Some functionality uses this to identify you, e.g. GPG configuration, email
;; clients, file te plates and snippets.
(setq user-full-name "Seonjin Lee"
      user-mail-address "sjbase@me.com")
#+end_src
** Auto save and other features
#+begin_src emacs-lisp :tangle yes
(when (eq system-type 'darwin)
  (osx-trash-setup))
(setq delete-by-moving-to-trash t)
;; Raise undo-limit to 80Mb
(setq undo-limit 80000000
      ;; More granular undo
      evil-want-fine-undo t
      auto-save-default t)

;; Show battery status
(display-battery-mode 1)
(setq display-time-default-load-average nil)
#+end_src
** Coding system
#+begin_src emacs-lisp :tangle yes
(prefer-coding-system       'utf-8)
(set-default-coding-systems 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
#+end_src
** Folders
#+begin_src emacs-lisp :tangle yes
(defconst my/config-file "~/Documents/Dev/dotfiles/doom-emacs/config.org")
(defconst my/bibtex-file "~/Documents/Academic/Org-papers/zotero-refs.bib")
(defconst my/org-roam-folder "~/Documents/RoamNotes")
(after! org
  (defconst my/org-folder "~/Documents/Org-mode/"))
#+end_src
* UI
** Font Settings
*** Font family and size
#+begin_src emacs-lisp :tangle yes
;; Set font family and size
(setq doom-font (font-spec :family "SFMono Nerd Font" :size 18)
      ;; doom-big-font (font-spec :family "FiraCode Nerd Font Mono" :size 26 :style "Retina")
      doom-variable-pitch-font (font-spec :family "ETbb" :size 18 :slant 'normal :weight 'normal))
#+end_src
**
*** Enable bold and italic
#+begin_src emacs-lisp :tangle yes
;; Enable bold and italic font
(setq doom-themes-enable-bold t
      doom-themes-enable-italic t)
#+end_src
** Theme
#+begin_src emacs-lisp :tangle yes
;; Set default theme
(setq doom-theme 'doom-plain)
#+end_src
** Theme change with system appearance
#+begin_src emacs-lisp :tangle yes
(defun apply-system-theme (appearance)
  "Load theme, taking current system APPEARANCE into consideration."
  (mapc #'disable-theme custom-enabled-themes)
  (pcase appearance
    ('light (load-theme 'doom-plain t))
    ('dark (load-theme 'doom-city-lights t))))

(add-hook 'ns-system-appearance-change-functions #'apply-system-theme)
#+end_src
**
** Header line
#+begin_src emacs-lisp :tangle yes
;; "Adds a bar with the same color as the fringe as the header-line.Imitates the look of wordprocessors a bit."
(setq-default header-line-format
    (concat
        (propertize " " 'display (list 'space :width 'left-fringe) 'face 'fringe)
        (propertize " " 'display (list 'space :width 'left-margin) 'face (list (list :height 800) 'default))
        (propertize " " 'display (list 'space :width 'text) 'face (list (list :height 800) 'default))
        ;(propertize (format " %dW" (count-words (point-min) (point-max))) 'face 'default)
        (propertize " " 'display (list 'space :width 'left-margin) 'face (list (list :height 800) 'default))
;;(propertize (format " %dW" (count-words (point-min) (point-max))) 'face 'fringe)
;; '("" mode-line-misc-info)
        (propertize " " 'display (list 'space :width 'left-fringe) 'face 'fringe))) ;
#+end_src
** Reframe pixelwise
#+begin_src emacs-lisp :tangle yes
(setq frame-resize-pixelwise t)
#+end_src
** Line numbers
#+begin_src emacs-lisp :tangle yes
;; This determines the style of line numbers in effect. If set to `nil', line
;; numbers are disabled. For relative line numbers, set this to `relative'.
(setq display-line-numbers-type 'relative)
#+end_src
** Splash image
#+begin_src emacs-lisp :tangle yes
;; Set splash image
(setq fancy-splash-image "~/.doom.d/misc/NASA_logo.png")
#+end_src
** Global hl-todo-mode
#+begin_src emacs-lisp :tangle yes
(global-hl-todo-mode 1)
#+end_src
** Window opacity
#+begin_src emacs-lisp :tangle yes
;; (doom/set-frame-opacity 97)
#+end_src
** Miniframe mode
#+begin_src emacs-lisp :tangle yes
(add-hook! 'special-mode-hook 'mini-frame-mode)
(custom-set-variables
 '(mini-frame-show-parameters
   '((top . 0.6)
     (width . 0.95)
     (left . 0.5))))
#+end_src
** Cursor settings
#+begin_src emacs-lisp :tangle yes
;; Add different colors for VIM state
(setq evil-normal-state-cursor '(box "DodgerBlue2")
      evil-insert-state-cursor '((bar . 3) "SeaGreen3")
      evil-replace-state-cursor '((hbar . 2) "firebrick2")
      ;; evil-motion-state-cursor '(bar "medium sea green")
      evil-visual-state-cursor '(hollow "orange"))
#+end_src
** Modeline Configuration
*** Remove UTF-8
#+begin_src emacs-lisp :tangle yes
;;Modeline remove utf-8
(defun doom-modeline-conditional-buffer-encoding ()
  (setq-local doom-modeline-buffer-encoding
              (unless (or (eq buffer-file-coding-system 'utf-8-unix)
                          (eq buffer-file-coding-system 'utf-8)))))
(add-hook 'after-change-major-mode-hook #'doom-modeline-conditional-buffer-encoding)
#+end_src
*** Display Time
#+begin_src emacs-lisp :tangle yes
;; Display time on mode-line
(display-time-mode 1)
(setq-default display-time-default-load-average nil)
#+end_src
*** Word count
#+begin_src emacs-lisp :tangle yes
;; If non-nil, a word count will be added to the selection-info modeline segment.
(setq doom-modeline-enable-word-count t)

;; Major modes in which to display word count continuously.
;; Also applies to any derived modes. Respects `doom-modeline-enable-word-count'.
;; If it brings the sluggish issue, disable `doom-modeline-enable-word-count' or
;; remove the modes from `doom-modeline-continuous-word-count-modes'.
(setq doom-modeline-continuous-word-count-modes '(markdown-mode gfm-mode org-mode))
#+end_src
*** Remove system load
#+begin_src emacs-lisp :tangle yes
(setq-default display-time-default-load-average nil)
#+end_src
*** Hide modeline for Pdf mode
#+begin_src emacs-lisp :tangle yes
(add-hook! 'pdf-view-mode-hook 'hide-mode-line-mode)
#+end_src
** Window size
#+begin_src emacs-lisp :tangle yes
(when window-system
  (setq initial-frame-alist
        '((top . 120)
          (left . 50)
          (width . 140)
          (height . 60))))
#+end_src
* Language
** Python
*** Exclude .venv from LSP watch
#+begin_src emacs-lisp :tangle yes
;; Exclude .venv from lsp watch
(after! lsp-mode
  (push "[/\\\\]\\.venv$" lsp-file-watch-ignored))
#+end_src
** English
*** Merriam-Webster thesaurus
#+begin_src emacs-lisp :tangle yes
(setq mw-thesaurus--api-key "601c421e-3f91-4a69-b8f9-e941735eab55")
#+end_src
* Org mode
** Org Directory
#+begin_src emacs-lisp :tangle yes
;; If you use `org' and don't want your org files in the default location below,
;; change `org-directory'. It must be set before org loads!
(after! org
  (setq org-directory my/org-folder))
(setq org-agenda-files '("~/Documents/Org-mode/"))

#+end_src
** Auto-tangle Configuration Files
#+begin_src emacs-lisp :tangle yes
;; Automatically tangle our Emacs.org config file when we save it
(defun auto-org-babel-tangle ()
  (when (string-equal (buffer-file-name)
                      (expand-file-name my/config-file))
    ;; Dynamic scoping to the rescue
    (let ((org-confirm-babel-evaluate nil))
      (org-babel-tangle))))

(add-hook 'org-mode-hook (lambda () (add-hook 'after-save-hook #'auto-org-babel-tangle)))
#+end_src
** Pretty symbols
#+begin_src emacs-lisp :tangle yes
;; Pretty Symbol    s
(defun org-icons ()
  "Beautify org mode keywords."
  (setq prettify-symbols-alist '(("[ ]" . "☐")
                                 ("[X]" . "☑")
                                 ("[-]" . "■")
                                 ("#+BEGIN_SRC" . "↦")
                                 ("#+END_SRC" . "⇤")
                                 ("#+begin_src" . "↦")
                                 ("#+end_src" . "⇤")
                                 ("#+BEGIN_EXAMPLE" . "↦")
                                 ("#+END_EXAMPLE" . "⇤")
                                 ("#+TITLE:" . "")
                                 ("#+title:" . "")
                                 ("->" . "→")
                                 ("<-" . "←")
                                 ("=>" . "⮕")
                                 ("#+BEGIN_QUOTE" . "↦")
                                 ("#+END_QUOTE" . "⇤")))
  (prettify-symbols-mode))

(add-hook 'org-mode-hook 'org-icons)
#+end_src
** Enable org-mode for txt files
#+begin_src emacs-lisp :tangle yes
(add-to-list 'auto-mode-alist '("\\.txt$" . org-mode))
#+end_src
** Hide emphasis marker
#+begin_src emacs-lisp :tangle yes
;; show actually italicized text instead of /italicized text/
(setq org-hide-emphasis-markers t
      org-ellipsis "  " ;; folding symbol
      ;; org-pretty-entities t
      org-startup-indented t
      org-agenda-block-separator "")
#+end_src
** No gutter for org
#+begin_src emacs-lisp :tangle yes
(after! git-gutter
  (setq git-gutter:disabled-modes '(org-mode image-mode)))
#+end_src
** Nicer org-mode
#+begin_src emacs-lisp :tangle yes
(defun nicer-org ()
  (progn
    (+org-pretty-mode 1)
    (org-pretty-table-mode 1)
    (abbrev-mode 1)
    (mixed-pitch-mode 1)
    (hl-line-mode -1)
    (display-line-numbers-mode -1)
    (hide-mode-line-mode 1)
    (olivetti-mode 1)
    (org-indent-mode -1)
    ))
(setq save-abbrevs t)
(setq save-abbrevs 'silently)
(setq only-global-abbrevs t)
(setq olivetti-body-width 0.85)
(add-hook! 'org-mode-hook  #'nicer-org)
(add-hook! 'org-mode-hook #'hl-todo-mode)
(remove-hook! 'org-mode-hook  'org-superstar-mode)
(remove-hook! 'org-mode-hook  'org-fancy-priorities-mode)
(remove-hook! 'org-mode-hook  'flycheck-mode)
#+end_src

#+RESULTS:

** Remove stars
#+begin_src emacs-lisp :tangle yes
(defun org-mode-remove-stars ()
  (font-lock-add-keywords
   nil
   '(("^\\*+ "
      (0
       (prog1 nil
         (put-text-property (match-beginning 0) (match-end 0)
                            'invisible t)))))))

(add-hook! 'org-mode-hook #'org-mode-remove-stars)
#+end_src
** Line spacing
#+begin_src emacs-lisp :tangle yes
(add-hook! 'org-mode-hook (setq-local line-spacing 0.1))
#+end_src
** Custom fonts color
#+begin_src emacs-lisp :tangle yes
(add-hook! 'doom-load-theme-hook
  (after! org
    (set-face-attribute
     'org-document-title nil :foreground (doom-color 'fg))
    (set-face-attribute
     'org-level-1 nil :foreground (doom-color 'fg))
    (set-face-attribute
     'org-level-2 nil :foreground (doom-color 'fg))
    (set-face-attribute
     'org-level-3 nil :foreground (doom-color 'fg))
    (set-face-attribute
     'org-level-4 nil :foreground (doom-color 'fg))
    (set-face-attribute
     'org-ellipsis nil  :foreground (doom-color 'grey)
                        :background (doom-color 'bg))
    (set-face-attribute
     'org-hide nil :background (doom-color 'bg))
    (set-face-attribute
     'org-block nil :background (doom-color 'bg))
    (set-face-attribute
     'org-block-begin-line nil :background (doom-color 'bg))
    (set-face-attribute
     'org-block-end-line nil :background (doom-color 'bg))
    (set-face-attribute
     'org-table nil  :foreground (doom-color 'fg)
                        :background (doom-color 'bg-alt))
    (set-face-attribute
     'org-agenda-date nil :foreground (doom-color 'grey))
    (set-face-attribute
     'org-agenda-date-today nil :foreground (doom-color 'blue))
    (set-face-attribute
     'org-agenda-date-weekend nil :foreground (doom-color 'red))))
#+end_src
** Custom fonts height
#+begin_src emacs-lisp :tangle yes
(custom-set-faces!
  '(tooltip
    :family "FiraCode Nerd Font Mono")
  '(org-level-1
    :height 1.6
    :weight bold)
  '(org-level-2
    :height 1.3
    :weight bold
    :slant italic)
  '(org-level-3
    :height 1.2
    :weight bold)
  '(org-level-4
    :height 1.1
    :weight bold)
  '(org-ellipsis
    :weight normal
    :slant normal)
  '(org-block-begin-line
    :slant italic)
  '(org-block-end-line
    :slant italic)
  '(org-headline-done
    :strike-through nil)
  '(org-agenda-date
    :weight normal)
  '(org-agenda-date-today
    :weight bold
    :slant italic
    :height 1.2)
  '(org-agenda-date-weekend
    :weight normal)
  '(org-document-title
    :weight bold
    :slant italic
    :height 1.9))
 #+end_src
** Custom Todo
#+begin_src emacs-lisp :tangle yes
(after! org
  (setq org-todo-keywords
        '((sequence "TODO(t)" "NEXT(n)" "|" "DONE(d)")
          (sequence "IDEA(i)" "READ(r)" "DATA(c)" "ANAL(a)" "WRITE(w)" "PROOF(o)" "U/R(u)" "RETURN(j)" "|" "FIN(f)" "KILL(k)"))
        org-todo-keyword-faces
        '(("TODO"   . "#D95468")
          ("NEXT"  . "#D98E48")
          ("DONE"  . "#008B94")
          ("IDEA"  . "#E27E8D")
          ("READ"  . "#EBBF83")
          ("DATA"  . "#8BD49C")
          ("ANAL"  . "#33CED8")
          ("WRITE"  . "#5EC4FF")
          ("PROOF"  . "#539AFC")
          ("RETURN" . "#D95468")
          ("U/R" . "#718CA1")
          ("FIN" . "#008B94")
          ("KILL"   . "grey"))))

(setq hl-todo-keyword-faces
      '(("TODO"   . "#D95468")
        ("NEXT"  . "#D98E48")
        ("DONE"  . "#008B94")
        ("IDEA"  . "#E27E8D")
        ("READ"  . "#EBBF83")
        ("DATA"  . "#8BD49C")
        ("ANAL"  . "#33CED8")
        ("WRITE"  . "#5EC4FF")
        ("PROOF"  . "#539AFC")
        ("RETURN" . "#D95468")
        ("U/R" . "#718CA1")
        ("FIN" . "#008B94")
        ("KILL"   . "grey")))
#+end_src
** Custom calender view
#+begin_src emacs-lisp :tangle yes
(setq org-agenda-format-date (lambda (date) (concat "\n"
                                                    (make-string (window-width) 9472)
                                                    "\n"
                                                    (org-agenda-format-date-aligned date))))
#+end_src
* Org noter
#+begin_src emacs-lisp :tangle yes
(setq org-noter-always-create-frame nil)
#+end_src
* Org-roam
** Basic configs
#+begin_src emacs-lisp :tangle yes
(setq org-roam-directory my/org-roam-folder)
(setq org-roam-node-display-template (concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))
#+end_src
** Org-roam UI
#+begin_src emacs-lisp :tangle yes
(map! :leader
      "n r u" #'org-roam-ui-mode)
#+end_src
** Ivy-bibtex
#+begin_src emacs-lisp :tangle yes
(setq bibtex-completion-bibliography my/bibtex-file
      bibtex-completion-pdf-field "file")
(add-hook! 'org-mode-hook #'org-roam-bibtex-mode)
#+end_src
** Org-ref
#+begin_src emacs-lisp :tangle yes
(setq
 org-ref-completion-library 'org-ref-ivy-cite
 org-ref-get-pdf-filename-function 'org-ref-get-pdf-filename-ivy-bibtex
 org-ref-default-bibliography my/bibtex-file
 org-ref-notes-function 'orb-edit-notes)
#+end_src
** Org-ref custom layout
#+begin_src emacs-lisp :tangle yes
(setq bibtex-completion-display-formats
      '((t . "${=has-pdf=:1}${=has-note=:1} ${author:20} ${year:4} ${title:*} ${=type=:7}")))
;; pretty simbols
(setq bibtex-completion-pdf-symbol "⌘")
(setq bibtex-completion-notes-symbol "✎")
#+end_src

#+RESULTS:

** Org-ref keybinding
#+begin_src emacs-lisp :tangle yes
(map! :map org-mode-map
      :leader
      "m @" #'org-ref-insert-cite-link
      :desc "Search bibliography"
      "m z" #'ivy-bibtex)
#+end_src
** Org-roam-bibtex link to org noter
#+begin_src emacs-lisp :tangle yes
(setq org-roam-capture-templates
      '(("n" "Org-noter" plain
         "%?"
         :target
         (file+head "%<%Y%m%d%H%M%S>-${slug}.org" "#+title: ${title}\n* Org-Noter\n:PROPERTIES:\n:NOTER_DOCUMENT: ${file}\n:END:")
         :unnarrowed t)))
#+end_src
* Custom Functions
** Center cursor
#+begin_src emacs-lisp :tangle yes
(define-minor-mode scroll-center-cursor-mode
  "Toggle centred cursor scrolling behavior"
  :init-value nil
  :lighter " S="
  :global nil
  (if scroll-center-cursor-mode
      (setq-local scroll-margin (* (frame-height) 2)
                  scroll-conservatively 0
                  maximum-scroll-margin 0.5)
    (dolist (local '(scroll-preserve-screen-position
                     scroll-conservatively
                     maximum-scroll-margin
                     scroll-margin))
      (kill-local-variable `,local)))
  )
#+end_src
** Auto-capitalize
#+begin_src emacs-lisp :tangle yes
(load! "misc/auto-capitalize")
(setq auto-capitalize-words `("I" "English"))
;; (add-hook 'org-mode-hook 'auto-capitalize-mode)
#+end_src
* Dired
#+begin_src emacs-lisp :tangle yes
(map! :map dired-mode-map
      :n "h" #'dired-up-directory
      :n "l" #'dired-view-file)
(map! :leader
      "o j" #'dired-jump
      "f n" #'dired-create-empty-file)
(after! dired
(setq dired-listing-switches "--group-directories-first -gaGh1v"))
#+end_src
* Elfeed
#+begin_src emacs-lisp :tangle yes
(setq elfeed-goodies/entry-pane-size 0.5)
(setq elfeed-feeds (quote
                    (("https://rss.sciencedirect.com/publication/science/02615177" Journal TM)
                     ("https://rss.sciencedirect.com/publication/science/01607383" Journal ATR))))
(map! :leader
      "o s" #'elfeed)
(map! :map elfeed-show-mode-map
      :n "J" #'elfeed-goodies/split-show-next
      :n "K" #'elfeed-goodies/split-show-prev)

#+end_src
* Emacs everywhere
#+begin_src emacs-lisp :tangle yes
;; (map! :map emacs-everywhere-mode-map
;;       :leader
;;       :desc "Finish Everywhere"
;;       "m s" #'emacs-everywhere-finish
;;       :desc "Abort Everywhere"
;;       "f d" #'emacs-everywhere-abort)
#+end_src
* Keybindings
** evil-easy-motion
*** Default keybinding
#+begin_src emacs-lisp :tangle yes
(evilem-default-keybindings "SPC")
#+end_src
** evil-snipe for visible
#+begin_src emacs-lisp :tangle yes
(setq evil-snipe-scope 'visible)
#+end_src
** Toggle org-indent
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Org-mode indent"
      "t i" #'org-indent-mode)
#+end_src
** Toggle company-mode
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Company autocompletion"
      "t c" #'company-mode)
#+end_src
** Toggle auto-capitalize-mode
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Auto capitalize"
      "t C" #'auto-capitalize-mode)
#+end_src
** Toggle abbrev-mode
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Abbrev-mode"
      "t a" #'abbrev-mode)
#+end_src
** Toggle scroll-center-cursor-mode
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Scroll center cursor"
      "t s" #'scroll-center-cursor-mode)
#+end_src
** Toggle git-gutter-mode
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Git gutter visual"
      "t G" #'git-gutter-mode)
#+end_src

** Toggle mode-line
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Mode-line"
      "t m" #'hide-mode-line-mode)
#+end_src

** Magit push
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Magit push"
      "g p" #'magit-push)
#+end_src

** Magit commit
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Magit commit"
      "g C" #'magit-commit)
#+end_src

** MW-Thesaurus
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "M&W Thesaurus at point"
      "s t" #'mw-thesaurus-lookup-at-point)
(map! :leader
      :desc "M&W Thesaurus"
      "s T" #'mw-thesaurus-lookup)
#+end_src

** PDF-Tools
#+begin_src emacs-lisp :tangle yes
;; Highlight selected
(map! :leader
      :desc "Highlight selected"
      "m h" #'pdf-annot-add-highlight-markup-annotation)

;; Delete annotation
(map! :leader
      :desc "Delete annotation"
      "m h" #'pdf-annot-delete)

;; Revert
(map! :leader
      :desc "Revert PDF buffer"
      "m r" #'pdf-view-revert-buffer)
#+end_src
** Abbrev define
#+begin_src emacs-lisp :tangle yes
(map! :leader
      :desc "Add abbreviation for word"
      "m w" #'add-global-abbrev)
(map! :leader
      :desc "Add expansion for abbrev"
      "m W" #'inverse-add-global-abbrev)
#+end_src
